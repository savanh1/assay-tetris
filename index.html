<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Assay Tetris — Touch Tuned</title>
<style>
:root{--bg1:#0b1222;--bg2:#111a33;--ink:#eaf0ff;--muted:#a9b8d6;--mono:ui-monospace,Menlo,Consolas,monospace;--ngs:#6366f1;--ihc:#f59e0b;--rna:#ef4444;--sp:#06b6d4;--img:#a855f7;--fish:#f43f5e;--qpcr:#10b981}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1600px 600px at 50% -10%,#1b2b55 0%,var(--bg1) 38%),linear-gradient(180deg,var(--bg1),var(--bg2))}
.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:12px}
.shell{width:min(1060px,96vw);background:linear-gradient(180deg,#0e1a34,#0c162c);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 24px 60px rgba(0,0,0,.5);padding:14px}
.head{margin:0 0 10px;text-align:center;font-weight:700}.sub{display:block;color:var(--muted);font-weight:500;font-size:14px;margin-top:2px}
.hud{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;font-family:var(--mono);font-size:13px;margin:6px 0 10px}.badge{background:#0e1b36;border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px}
.grid{display:grid;gap:14px;grid-template-columns:1fr 320px}@media(max-width:960px){.grid{grid-template-columns:1fr}}
.boardWrap{position:relative;background:#08152d;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:10px}
.board{display:block;margin:0 auto;background:linear-gradient(180deg,#0a1832,#081429);border:1px solid rgba(255,255,255,.08);border-radius:12px;touch-action:none}
.panel{background:#0e1b36;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px}.panel h3{margin:0 0 8px}
.legend{font-size:13px;color:var(--muted);line-height:1.4}.pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);margin:0 6px 6px 0;font-family:var(--mono);font-size:12px}
.msg{min-height:42px;background:#0b1833;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px;font-family:var(--mono);font-size:13px;margin-top:10px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}.btn{appearance:none;border:1px solid rgba(255,255,255,.14);background:radial-gradient(120px 60px at 50% 20%,rgba(255,255,255,.08),rgba(255,255,255,.03));color:var(--ink);border-radius:10px;padding:8px 10px;font-family:var(--mono);cursor:pointer}.btn:hover{border-color:#5a7cff}
.touchpad{position:fixed;left:0;right:0;bottom:14px;display:flex;justify-content:center;gap:10px;pointer-events:none}
.tbtn{pointer-events:auto;min-width:56px;min-height:56px;display:flex;align-items:center;justify-content:center;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.16),rgba(255,255,255,.08));border:1px solid rgba(255,255,255,.22);backdrop-filter:blur(6px);color:var(--ink);font-family:var(--mono);font-size:15px;user-select:none;touch-action:none;box-shadow:0 8px 24px rgba(0,0,0,.35)}
@media(min-width:480px){.tbtn{min-width:60px;min-height:60px}}.tbtn:active{background:linear-gradient(180deg,rgba(255,255,255,.22),rgba(255,255,255,.1))}
.overlay{position:absolute;inset:10px;display:none;align-items:center;justify-content:center;background:rgba(4,10,22,.55);border-radius:12px;border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(3px)}
.overlay .panel{background:#0c1730;border-radius:14px;border:1px solid rgba(255,255,255,.1);text-align:center;padding:14px 16px}
</style></head><body>
<div class="wrap"><div class="shell">
<h1 class="head">Assay Tetris <span class="sub">Build a translational pipeline with complementary assays</span></h1>
<div class="hud"><div class="badge">Score: <b id="score">0</b></div><div class="badge">Level: <b id="level">1</b></div><div class="badge">Lines: <b id="lines">0</b></div><div class="badge">Hold: <b id="holdLabel">None</b></div></div>
<div class="grid">
  <div class="boardWrap">
    <canvas id="board" class="board" width="330" height="660"></canvas>
    <div id="overlay" class="overlay"><div class="panel"><h3 id="ovTitle">Paused</h3><p class="legend" id="ovText">Press P to resume or R to restart.</p><div class="controls"><button class="btn" id="ovResume">Resume (P)</button><button class="btn" id="ovRestart">Restart (R)</button></div></div></div>
    <div class="msg" id="msg">Tip: Mix assays. Complementary data reduces blind spots.</div>
  </div>
  <div class="panel"><h3>Assays</h3><div class="legend">
    <span class="pill" style="border-color:var(--ngs)">NGS</span> broad variants<br>
    <span class="pill" style="border-color:var(--ihc)">IHC</span> protein localization<br>
    <span class="pill" style="border-color:var(--rna)">RNA‑seq</span> expression<br>
    <span class="pill" style="border-color:var(--sp)">Spatial</span> context<br>
    <span class="pill" style="border-color:var(--img)">Imaging</span> morphology<br>
    <span class="pill" style="border-color:var(--fish)">FISH</span> ampli/fusions<br>
    <span class="pill" style="border-color:var(--qpcr)">qPCR</span> targeted DNA/RNA</div>
    <div class="controls"><button class="btn" id="btnPause">Pause (P)</button><button class="btn" id="btnRestart">Restart (R)</button></div>
    <div class="legend" style="margin-top:10px"><b>Desktop</b> ← → move, ↑ rotate, ↓ soft drop, Space hard drop, C hold, P pause, R restart.</div>
  </div>
</div></div></div>
<div class="touchpad" id="pad" aria-hidden="true"><div class="tbtn" id="tLeft">◀</div><div class="tbtn" id="tRight">▶</div><div class="tbtn" id="tRotate">↻</div><div class="tbtn" id="tDown">↓</div><div class="tbtn" id="tDrop">DROP</div></div>

<script>
(()=>{
const COLS=10,ROWS=22,SZ=30,board=document.getElementById('board'),ctx=board.getContext('2d');
const pad=document.getElementById('pad'); const touch=('ontouchstart'in window)||navigator.maxTouchPoints>0; pad.style.display=touch?'flex':'none';
const C={I:'#6366f1',O:'#f59e0b',T:'#ef4444',S:'#06b6d4',Z:'#f43f5e',J:'#a855f7',L:'#10b981'}, L={I:'NGS',O:'IHC',T:'RNA',S:'SP',Z:'FISH',J:'IMG',L:'qPCR'};
const SH={I:[[1,1,1,1]],O:[[1,1],[1,1]],T:[[1,1,1],[0,1,0]],S:[[0,1,1],[1,1,0]],Z:[[1,1,0],[0,1,1]],J:[[1,0,0],[1,1,1]],L:[[0,0,1],[1,1,1]]};
let G=Array.from({length:ROWS},()=>Array(COLS).fill(null)),cur=null,mat=null,x=3,y=0,hold=null,held=false,bag=[],next=nxt(),t=0,iv=800,last=0,paused=false,over=false,lv=1,ln=0,sc=0;
function nxt(){ if(!bag.length){bag=['I','O','T','S','Z','J','L']; for(let i=bag.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[bag[i],bag[j]]=[bag[j],bag[i]]}} return bag.pop(); }
function newP(){ cur=next; next=nxt(); mat=SH[cur].map(r=>r.slice()); x=3;y=-2; held=false; if(col(mat,x,y+2)){ over=true; show('Game Over','Press R to restart.'); } }
function col(m,px,py){ for(let r=0;r<m.length;r++)for(let c=0;c<m[0].length;c++)if(m[r][c]){const nx=px+c,ny=py+r;if(nx<0||nx>=COLS||ny>=ROWS)return true;if(ny>=0&&G[ny][nx])return true} return false; }
function place(){ for(let r=0;r<mat.length;r++)for(let c=0;c<mat[0].length;c++)if(mat[r][c]){const nx=x+c,ny=y+r;if(ny>=0&&ny<ROWS)G[ny][nx]={k:cur}} const n=clearL(); sc+=[0,100,300,500,800][n]||0; ln+=n; if(n&&((ln/10|0)+1>lv)){ lv=(ln/10|0)+1; iv=Math.max(120,800-(lv-1)*70) } score.textContent=sc; level.textContent=lv; lines.textContent=ln; newP(); }
function clearL(){ let n=0; for(let r=ROWS-1;r>=0;r--){ if(G[r].every(v=>v)){G.splice(r,1);G.unshift(Array(COLS).fill(null)); r++; n++; } } if(n) tip(n); return n; }
const tips=['IHC + NGS: confirm variant with protein expression.','qPCR for targeted calls; NGS for breadth.','RNA‑seq adds expression context.','Spatial + IHC: tissue context.','Imaging links morphology with molecular data.','FISH validates amplifications/fusions.'];
function tip(n){ msg.textContent=(n===4?'Full stack: ':n===3?'Strong combo: ':n===2?'Complementary set: ':'Good fit: ')+tips[(Math.random()*tips.length)|0]; }
function rr(px,py,w,h,r){const k=Math.min(r,w/2,h/2);ctx.beginPath();ctx.moveTo(px+k,py);ctx.arcTo(px+w,py,px+w,py+h,k);ctx.arcTo(px+w,py+h,px,py+h,k);ctx.arcTo(px,py+h,px,py,k);ctx.arcTo(px,py,px+w,py,k);ctx.closePath()}
function drawCell(px,py,k,a=1){ctx.save();ctx.globalAlpha=a;ctx.shadowColor=C[k];ctx.shadowBlur=12;ctx.fillStyle=C[k];rr(px+3,py+3,SZ-6,SZ-6,6);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle='#0b142a';ctx.font='bold 12px var(--mono)';ctx.textAlign='center';ctx.fillText(L[k],px+SZ/2,py+SZ/2+4);ctx.restore()}
function draw(){ctx.clearRect(0,0,board.width,board.height);ctx.fillStyle='#0a1832';ctx.fillRect(0,0,board.width,board.height);
 for(let r=2;r<ROWS;r++)for(let c=0;c<COLS;c++){const cell=G[r][c]; if(cell) drawCell(c*SZ,(r-2)*SZ,cell.k,1)}
 if(!over){let gy=y; while(!col(mat,x,gy+1))gy++; for(let r=0;r<mat.length;r++)for(let c=0;c<mat[0].length;c++)if(mat[r][c]){const gx=(x+c)*SZ,gy2=(gy-2+r)*SZ;if(gy2>=0)drawCell(gx,gy2,cur,.18)} for(let r=0;r<mat.length;r++)for(let c=0;c<mat[0].length;c++)if(mat[r][c]){const ax=(x+c)*SZ,ay=(y-2+r)*SZ;if(ay>=-SZ)drawCell(ax,ay,cur,1)} }
}
function mv(dx){ if(!paused&&!over&&!col(mat,x+dx,y)) x+=dx }
function sd(){ if(paused||over) return; if(!col(mat,x,y+1)) y++; else place() }
function hd(){ if(paused||over) return; while(!col(mat,x,y+1)) y++; place() }
function rot(m){const R=m.length,C=m[0].length,res=Array.from({length:C},()=>Array(R).fill(0));for(let r=0;r<R;r++)for(let c=0;c<C;c++)res[c][R-1-r]=m[r][c];return res}
function rt(){ if(paused||over) return; const r=rot(mat); if(!col(r,x,y)) mat=r; else if(!col(r,x-1,y)){x--;mat=r}else if(!col(r,x+1,y)){x++;mat=r} }
function holdSwap(){ if(paused||over||held) return; if(!hold){hold=cur; newP()} else {const tmp=hold; hold=cur; cur=tmp; mat=SH[cur].map(v=>v.slice()); x=3;y=-2;} holdLabel.textContent=L[hold]||'None'; held=true }
function show(t,txt){ ovTitle.textContent=t; ovText.textContent=txt; overlay.style.display='flex' } function hide(){ overlay.style.display='none' }
function loop(ts=0){const dt=ts-last; last=ts; if(!paused&&!over){ t+=dt; if(t>iv){ sd(); t=0 } } draw(); requestAnimationFrame(loop) }
function restart(){ G=Array.from({length:ROWS},()=>Array(COLS).fill(null)); bag=[]; next=nxt(); hold=null; held=false; lv=1; ln=0; sc=0; iv=800; score.textContent=0; level.textContent=1; lines.textContent=0; holdLabel.textContent='None'; msg.textContent='Tip: Mix assays. Complementary data reduces blind spots.'; paused=false; over=false; hide(); newP(); last=performance.now(); t=0; requestAnimationFrame(loop) }
window.addEventListener('keydown',e=>{ if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown',' ','p','P','r','R','c','C'].includes(e.key)) e.preventDefault();
 if(e.key==='r'||e.key==='R'){restart();return} if(e.key==='p'||e.key==='P'){ if(over) return; paused=!paused; if(paused) show('Paused','Press P to resume or R to restart.'); else hide(); return }
 if(over||paused) return; if(e.key==='ArrowLeft') mv(-1); if(e.key==='ArrowRight') mv(1); if(e.key==='ArrowUp') rt(); if(e.key==='ArrowDown') sd(); if(e.key===' ') hd(); if(e.key==='c'||e.key==='C') holdSwap();
},{passive:false});
function holdRepeat(el,fn,delay=180,step=65){let timer=null,rep=null;const start=e=>{e.preventDefault();fn();timer=setTimeout(()=>rep=setInterval(fn,step),delay)};const stop=()=>{clearTimeout(timer);clearInterval(rep);timer=rep=null}; el.addEventListener('pointerdown',start,{passive:false});['pointerup','pointerleave','pointercancel'].forEach(v=>el.addEventListener(v,stop))}
holdRepeat(tLeft,()=>mv(-1)); holdRepeat(tRight,()=>mv(1)); holdRepeat(tDown,()=>sd(),140,55); tRotate.addEventListener('pointerdown',e=>{e.preventDefault();rt()},{passive:false}); tDrop.addEventListener('pointerdown',e=>{e.preventDefault();hd()},{passive:false});
ovRestart.addEventListener('click',restart); ovResume.addEventListener('click',()=>{if(!over){paused=false;hide()}}); btnRestart.addEventListener('click',restart); btnPause.addEventListener('click',()=>{if(!over){paused=!paused;if(paused)show('Paused','Press P to resume or R to restart.');else hide()}});
newP(); requestAnimationFrame(loop);
})();
</script></body></html>